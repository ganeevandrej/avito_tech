import{r as u,u as k,j as s,s as f,c as w,e as E,m as $,a as B,g as P,l as W,I as H,J as z,K as D,L as Q,M as q,A as T,N as V,O as G,T as h,S as v,w as S,v as I,x as F,P as J,C as Y}from"./index-B015_MRd.js";import{C as L,b as O,a as K,f as _,u as X,c as Z}from"./client-DGgamOrK.js";import{m as tt,n as et,f as st,i as it,r as rt,M as nt,h as ot,e as at,p as lt}from"./moderationActions-Bew5sUyQ.js";const ct=t=>{const{absolute:e,children:i,classes:r,flexItem:a,light:d,orientation:n,textAlign:l,variant:c}=t;return E({root:["root",e&&"absolute",c,d&&"light",n==="vertical"&&"vertical",a&&"flexItem",i&&"withChildren",i&&n==="vertical"&&"withChildrenVertical",l==="right"&&n!=="vertical"&&"textAlignRight",l==="left"&&n!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",n==="vertical"&&"wrapperVertical"]},tt,r)},dt=f("div",{name:"MuiDivider",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:i}=t;return[e.root,i.absolute&&e.absolute,e[i.variant],i.light&&e.light,i.orientation==="vertical"&&e.vertical,i.flexItem&&e.flexItem,i.children&&e.withChildren,i.children&&i.orientation==="vertical"&&e.withChildrenVertical,i.textAlign==="right"&&i.orientation!=="vertical"&&e.textAlignRight,i.textAlign==="left"&&i.orientation!=="vertical"&&e.textAlignLeft]}})($(({theme:t})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:t.alpha((t.vars||t).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:t.spacing(2),marginRight:t.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:t.spacing(1),marginBottom:t.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:e})=>!!e.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:e})=>e.children&&e.orientation!=="vertical",style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:e})=>e.orientation==="vertical"&&e.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:e})=>e.textAlign==="right"&&e.orientation!=="vertical",style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:e})=>e.textAlign==="left"&&e.orientation!=="vertical",style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),ht=f("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(t,e)=>{const{ownerState:i}=t;return[e.wrapper,i.orientation==="vertical"&&e.wrapperVertical]}})($(({theme:t})=>({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`}}]}))),M=u.forwardRef(function(e,i){const r=k({props:e,name:"MuiDivider"}),{absolute:a=!1,children:d,className:n,orientation:l="horizontal",component:c=d||l==="vertical"?"div":"hr",flexItem:o=!1,light:x=!1,role:m=c!=="hr"?"separator":void 0,textAlign:p="center",variant:g="fullWidth",...j}=r,b={...r,absolute:a,component:c,flexItem:o,light:x,orientation:l,role:m,textAlign:p,variant:g},y=ct(b);return s.jsx(dt,{as:c,className:w(y.root,n),role:m,ref:i,ownerState:b,"aria-orientation":m==="separator"&&(c!=="hr"||l==="vertical")?l:void 0,...j,children:d?s.jsx(ht,{className:y.wrapper,ownerState:b,children:d}):null})});M&&(M.muiSkipListHighlight=!0);function ut(t){return B("MuiImageList",t)}P("MuiImageList",["root","masonry","quilted","standard","woven"]);const U=u.createContext({}),pt=t=>{const{classes:e,variant:i}=t;return E({root:["root",i]},ut,e)},gt=f("ul",{name:"MuiImageList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:i}=t;return[e.root,e[i.variant]]}})({display:"grid",overflowY:"auto",listStyle:"none",padding:0,WebkitOverflowScrolling:"touch",variants:[{props:{variant:"masonry"},style:{display:"block"}}]}),mt=u.forwardRef(function(e,i){const r=k({props:e,name:"MuiImageList"}),{children:a,className:d,cols:n=2,component:l="ul",rowHeight:c="auto",gap:o=4,style:x,variant:m="standard",...p}=r,g=u.useMemo(()=>({rowHeight:c,gap:o,variant:m}),[c,o,m]),j=m==="masonry"?{columnCount:n,columnGap:o,...x}:{gridTemplateColumns:`repeat(${n}, 1fr)`,gap:o,...x},b={...r,component:l,gap:o,rowHeight:c,variant:m},y=pt(b);return s.jsx(gt,{as:l,className:w(y.root,y[m],d),ref:i,style:j,ownerState:b,...p,children:s.jsx(U.Provider,{value:g,children:a})})});function xt(t){return B("MuiImageListItem",t)}const R=P("MuiImageListItem",["root","img","standard","woven","masonry","quilted"]),vt=t=>{const{classes:e,variant:i}=t;return E({root:["root",i],img:["img"]},xt,e)},ft=f("li",{name:"MuiImageListItem",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:i}=t;return[{[`& .${R.img}`]:e.img},e.root,e[i.variant]]}})({display:"block",position:"relative",[`& .${R.img}`]:{objectFit:"cover",width:"100%",height:"100%",display:"block"},variants:[{props:{variant:"standard"},style:{display:"flex",flexDirection:"column"}},{props:{variant:"woven"},style:{height:"100%",alignSelf:"center","&:nth-of-type(even)":{height:"70%"}}},{props:{variant:"standard"},style:{[`& .${R.img}`]:{height:"auto",flexGrow:1}}}]}),bt=u.forwardRef(function(e,i){const r=k({props:e,name:"MuiImageListItem"}),{children:a,className:d,cols:n=1,component:l="li",rows:c=1,style:o,...x}=r,{rowHeight:m="auto",gap:p,variant:g}=u.useContext(U);let j="auto";g==="woven"?j=void 0:m!=="auto"&&(j=m*c+p*(c-1));const b={...r,cols:n,component:l,gap:p,rowHeight:m,rows:c,variant:g},y=vt(b);return s.jsx(ft,{as:l,className:w(y.root,y[g],d),ref:i,style:{height:j,gridColumnEnd:g!=="masonry"?`span ${n}`:void 0,gridRowEnd:g!=="masonry"?`span ${c}`:void 0,marginBottom:g==="masonry"?p:void 0,breakInside:g==="masonry"?"avoid":void 0,...o},ownerState:b,...x,children:u.Children.map(a,C=>u.isValidElement(C)?C.type==="img"||et(C,["Image"])?u.cloneElement(C,{className:w(y.img,C.props.className)}):C:null)})}),yt=W(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"})),jt=W(s.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}));var Ct=class extends H{#e;#i=void 0;#t;#s;constructor(t,e){super(),this.#e=t,this.setOptions(e),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#e.defaultMutationOptions(t),z(this.options,e)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),e?.mutationKey&&this.options.mutationKey&&D(e.mutationKey)!==D(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#r(),this.#n(t)}getCurrentResult(){return this.#i}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#r(),this.#n()}mutate(t,e){return this.#s=e,this.#t?.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(t)}#r(){const t=this.#t?.state??Q();this.#i={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){q.batch(()=>{if(this.#s&&this.hasListeners()){const e=this.#i.variables,i=this.#i.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#s.onSuccess?.(t.data,e,i,r),this.#s.onSettled?.(t.data,null,e,i,r)):t?.type==="error"&&(this.#s.onError?.(t.error,e,i,r),this.#s.onSettled?.(void 0,t.error,e,i,r))}this.listeners.forEach(e=>{e(this.#i)})})}};function A(t,e){const i=T(),[r]=u.useState(()=>new Ct(i,t));u.useEffect(()=>{r.setOptions(t)},[r,t]);const a=u.useSyncExternalStore(u.useCallback(n=>r.subscribe(q.batchCalls(n)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d=u.useCallback((n,l)=>{r.mutate(n,l).catch(V)},[r]);if(a.error&&G(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:d,mutateAsync:a.mutate}}const It=({history:t})=>s.jsx(L,{sx:{bgcolor:"warning.50"},children:s.jsxs(O,{children:[s.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"История модерации"}),!t.length&&s.jsx(h,{color:"text.secondary",children:"Записей пока нет"}),s.jsx(v,{spacing:1.5,children:t.map(e=>s.jsxs(v,{spacing:.5,children:[s.jsx(h,{fontWeight:600,children:e.moderatorName}),s.jsx(h,{variant:"body2",color:"text.secondary",children:K(e.timestamp)}),s.jsx(h,{variant:"body2",children:e.action}),e.reason&&s.jsxs(h,{variant:"body2",color:"text.secondary",children:["Причина: ",e.reason]}),e.comment&&s.jsxs(h,{variant:"body2",color:"text.secondary",children:["Комментарий: ",e.comment]})]},e.id))})]})}),wt=({ad:t})=>s.jsx(L,{children:s.jsx(O,{children:s.jsxs(v,{spacing:2,children:[s.jsx(h,{variant:"h6",component:"h2",children:"Полное описание"}),s.jsx(h,{color:"text.secondary",children:t.description}),s.jsx(M,{}),s.jsx(h,{fontWeight:600,children:"Характеристики"}),s.jsx(v,{spacing:.5,children:Object.entries(t.characteristics).map(([e,i])=>s.jsxs(v,{direction:"row",spacing:1,children:[s.jsx(h,{width:160,color:"text.secondary",children:e}),s.jsx(h,{children:i})]},e))}),s.jsx(M,{}),s.jsx(h,{fontWeight:600,children:"Продавец"}),s.jsxs(h,{children:[t.seller.name," • рейтинг ",t.seller.rating," • ",t.seller.totalAds," объявлений • на платформе с ",K(t.seller.registeredAt)]}),s.jsxs(h,{variant:"subtitle1",children:["Стоимость: ",_(t.price)]})]})})}),Mt=({images:t})=>{const e=t.length>0,i=e?t.slice(0,3):[];return s.jsx(L,{sx:{height:"100%"},children:s.jsxs(O,{children:[s.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"Галерея"}),e?s.jsx(mt,{cols:i.length===1?1:i.length===2?2:3,gap:8,children:i.map((r,a)=>s.jsx(bt,{children:s.jsx(St,{src:r,alt:`Изображение ${a+1}`})},r))}):s.jsx(Lt,{children:"Изображения отсутствуют"})]})})},St=f("img")(({theme:t})=>({width:"100%",height:120,objectFit:"cover",borderRadius:t.shape.borderRadius})),Lt=f(S)(({theme:t})=>({height:160,borderRadius:t.spacing(2),backgroundColor:t.palette.grey[50],border:"1px dashed",borderColor:t.palette.grey[300],display:"flex",alignItems:"center",justifyContent:"center",color:t.palette.text.secondary})),Rt=(t,e)=>{const i=T(),{onOpenDialog:r}=e??{},a=()=>{i.invalidateQueries({queryKey:["ads"]}),i.invalidateQueries({queryKey:["ad",t]})},d=A({mutationFn:()=>st(t),onSuccess:a}),n=A({mutationFn:({reason:p,comment:g})=>rt(t,p,g),onSuccess:a}),l=A({mutationFn:({reason:p,comment:g})=>it(t,p,g),onSuccess:a}),c=u.useCallback(()=>{d.mutate()},[d]),o=p=>{n.mutate(p)},x=p=>{l.mutate(p)};return{actionStateMap:u.useMemo(()=>({approve:{handler:c,disabled:d.isPending},reject:{handler:()=>r?.("reject"),disabled:n.isPending},changes:{handler:()=>r?.("changes"),disabled:l.isPending}}),[d.isPending,l.isPending,c,r,n.isPending]),handleReject:o,handleRequestChanges:x}},At=({adId:t})=>{const[e,i]=u.useState(null),{actionStateMap:r,handleReject:a,handleRequestChanges:d}=Rt(t,{onOpenDialog:i}),n=o=>{e==="reject"?a(o):e==="changes"&&d(o),i(null)},l=o=>{const x=r[o.key];return x?s.jsx(I,{variant:o.key==="approve"?"contained":"outlined",color:o.color,startIcon:o.icon,disabled:x.disabled,onClick:x.handler,children:o.label},o.key):null},c=nt.filter(o=>o.key!=="clear");return s.jsxs(s.Fragment,{children:[s.jsx(v,{direction:{xs:"column",sm:"row"},spacing:2,children:c.map(o=>s.jsx(u.Fragment,{children:l(o)},o.key))}),s.jsx(ot,{mode:e,open:e!==null,onClose:()=>i(null),onSubmit:n})]})},kt=({adId:t})=>{const e=F(),i=at(n=>n.list.lastLoadedIds),{prevId:r,nextId:a}=u.useMemo(()=>{const n=i.findIndex(o=>o===t),l=n>0?i[n-1]:null,c=n>=0&&n<i.length-1?i[n+1]:null;return{prevId:l,nextId:c}},[t,i]),d=n=>{n&&e(`/item/${n}`)};return s.jsx(Et,{children:s.jsxs(Ot,{children:[s.jsx(I,{variant:"text",color:"inherit",startIcon:s.jsx(yt,{}),onClick:()=>e("/list"),children:"К списку"}),s.jsx(At,{adId:t}),s.jsxs(v,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(I,{variant:"text",color:"inherit",disabled:!r,onClick:()=>d(r),children:"◀ Пред"}),s.jsx(h,{variant:"body1",color:"text.secondary",children:"|"}),s.jsx(I,{variant:"text",color:"inherit",disabled:!a,onClick:()=>d(a),children:"След ▶"})]})]})})},Et=f(L)(({theme:t})=>({zIndex:1,padding:t.spacing(2),[t.breakpoints.up("md")]:{position:"sticky",bottom:t.spacing(2)}})),Ot=f(v)(({theme:t})=>({flexDirection:"column",gap:t.spacing(2),[t.breakpoints.up("md")]:{flexDirection:"row",alignItems:"center",justifyContent:"space-between"}})),N=()=>{const t=F();return s.jsx(Dt,{children:s.jsxs(Nt,{children:[s.jsx($t,{children:"404"}),s.jsx(h,{variant:"h4",gutterBottom:!0,fontWeight:600,children:"Объявление не найдено"}),s.jsx(h,{variant:"body1",color:"text.secondary",mb:4,textAlign:"center",children:"Запрашиваемое объявление не существует или было удалено"}),s.jsx(v,{direction:"row",spacing:2,justifyContent:"center",children:s.jsx(I,{variant:"contained",color:"inherit",startIcon:s.jsx(jt,{}),onClick:()=>t("/list"),children:"Вернуться к списку"})})]})})},Dt=f(S)(({theme:t})=>({minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:t.spacing(4)})),Nt=f(S)({textAlign:"center",maxWidth:500}),$t=f(h)(({theme:t})=>({fontSize:"8rem",fontWeight:700,lineHeight:1,color:t.palette.text.disabled,marginBottom:t.spacing(2)})),qt=()=>{const{id:t}=J(),e=Number(t),i=X({queryKey:["ad",e],queryFn:({signal:a})=>lt(e,a),enabled:Number.isInteger(e)});if(!Number.isInteger(e))return s.jsx(N,{});if(i.isLoading)return s.jsx(S,{textAlign:"center",py:8,children:s.jsx(Y,{})});if(i.isError){if(Z.isAxiosError(i.error)&&i.error.response?.status===404)return s.jsx(N,{});throw new Error("Непредвиденная ошибка при загрузке объявления")}if(!i.data)throw new Error("Данные объявления не найдены");const r=i.data;return s.jsxs(v,{spacing:3,children:[s.jsxs(v,{direction:{xs:"column",md:"row"},spacing:3,children:[s.jsx(Mt,{images:r.images}),s.jsx(It,{history:r.moderationHistory})]}),s.jsx(wt,{ad:r}),s.jsx(kt,{adId:e})]})};export{qt as default};
